<!-- Firebase + ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ©Ÿèƒ½ä»˜ã index.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒ›ãƒ³ãƒˆã«ä»Šï¼ï¼Ÿ</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 50px; background: #fffce6; }
    #ranking-area { margin-top: 40px; }
    button { font-size: 20px; margin: 10px; padding: 10px 20px; border-radius: 10px; }
    input { padding: 8px; font-size: 18px; }
  </style>
</head>
<body>
  <h1>ãƒ›ãƒ³ãƒˆã«ä»Šï¼ï¼ŸğŸ”¥</h1>
  <div>
    <p>ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼ˆãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«è¨˜éŒ²ã•ã‚Œã¾ã™ï¼‰</p>
    <input type="text" id="nickname" placeholder="ä¾‹: ã‚ã„ãŸã‚“" />
    <br><br>
    <button onclick="startGame()">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
  </div>

  <div id="game-area" style="display:none">
    <h2 id="message">æº–å‚™ä¸­â€¦</h2>
    <div>ã‚¹ã‚³ã‚¢: <span id="score">0</span></div>
    <div>ã‚¿ã‚¤ãƒãƒ¼: <span id="timer">30</span>ç§’</div>
    <button id="tap-button" onclick="handleTap()">ã‚¿ãƒƒãƒ—ï¼</button>
  </div>

  <div id="ranking-area">
    <h2>ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
    <ol id="ranking-list"></ol>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyACaSgxm_X4Tnui4VSyUF9aMdCjYSssfLQ",
      authDomain: "cyo-ima.firebaseapp.com",
      projectId: "cyo-ima",
      storageBucket: "cyo-ima.appspot.com",
      messagingSenderId: "224682082263",
      appId: "1:224682082263:web:4a631a3571932ee6e21592",
      measurementId: "G-F0XBGLK752"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let score = 0;
    let timer = 30;
    let interval;
    let isNow = false;

    function startGame() {
      const nick = document.getElementById("nickname").value.trim();
      if (!nick) {
        alert("ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        return;
      }
      document.querySelector("#game-area").style.display = "block";
      document.querySelector("#message").textContent = "ã‚¹ã‚¿ãƒ¼ãƒˆï¼";
      score = 0;
      timer = 30;
      document.querySelector("#score").textContent = score;
      document.querySelector("#timer").textContent = timer;
      interval = setInterval(updateGame, 1000);
      showMessage();
    }

    function updateGame() {
      timer--;
      document.querySelector("#timer").textContent = timer;
      if (timer <= 0) {
        clearInterval(interval);
        endGame();
      } else {
        showMessage();
      }
    }

    function showMessage() {
      isNow = Math.random() < 0.5;
      document.querySelector("#message").textContent = isNow ? "ä»Šï¼" : "ä»Šã˜ã‚ƒãªã„ï¼";
    }

    function handleTap() {
      if (timer <= 0) return;
      score += isNow ? 1 : -3;
      if (score < 0) score = 0;
      document.querySelector("#score").textContent = score;
    }

    function endGame() {
      document.querySelector("#message").textContent = "çµ‚äº†ï¼";
      const nick = document.getElementById("nickname").value.trim();
      db.collection("scores").add({
        name: nick,
        score: score,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      }).then(loadRanking);
    }

    function loadRanking() {
      db.collection("scores")
        .orderBy("score", "desc")
        .limit(10)
        .get()
        .then(snapshot => {
          const list = document.getElementById("ranking-list");
          list.innerHTML = "";
          snapshot.forEach(doc => {
            const data = doc.data();
            const li = document.createElement("li");
            li.textContent = `${data.name}ï¼š${data.score}ç‚¹`;
            list.appendChild(li);
          });
        });
    }

    window.onload = loadRanking;
  </script>
</body>
</html>
