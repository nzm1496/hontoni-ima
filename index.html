<!-- Firebase + ランキング機能付き index.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ホントに今！？</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 50px; background: #fffce6; }
    #ranking-area { margin-top: 40px; }
    button { font-size: 20px; margin: 10px; padding: 10px 20px; border-radius: 10px; }
    input { padding: 8px; font-size: 18px; }
  </style>
</head>
<body>
  <h1>ホントに今！？🔥</h1>
  <div>
    <p>ニックネーム（ランキングに記録されます）</p>
    <input type="text" id="nickname" placeholder="例: めいたん" />
    <br><br>
    <button onclick="startGame()">ゲームスタート</button>
  </div>

  <div id="game-area" style="display:none">
    <h2 id="message">準備中…</h2>
    <div>スコア: <span id="score">0</span></div>
    <div>タイマー: <span id="timer">30</span>秒</div>
    <button id="tap-button" onclick="handleTap()">タップ！</button>
  </div>

  <div id="ranking-area">
    <h2>🏆 ランキング</h2>
    <ol id="ranking-list"></ol>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyACaSgxm_X4Tnui4VSyUF9aMdCjYSssfLQ",
      authDomain: "cyo-ima.firebaseapp.com",
      projectId: "cyo-ima",
      storageBucket: "cyo-ima.appspot.com",
      messagingSenderId: "224682082263",
      appId: "1:224682082263:web:4a631a3571932ee6e21592",
      measurementId: "G-F0XBGLK752"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let score = 0;
    let timer = 30;
    let interval;
    let isNow = false;

    function startGame() {
      const nick = document.getElementById("nickname").value.trim();
      if (!nick) {
        alert("ニックネームを入力してください");
        return;
      }
      document.querySelector("#game-area").style.display = "block";
      document.querySelector("#message").textContent = "スタート！";
      score = 0;
      timer = 30;
      document.querySelector("#score").textContent = score;
      document.querySelector("#timer").textContent = timer;
      interval = setInterval(updateGame, 1000);
      showMessage();
    }

    function updateGame() {
      timer--;
      document.querySelector("#timer").textContent = timer;
      if (timer <= 0) {
        clearInterval(interval);
        endGame();
      } else {
        showMessage();
      }
    }

    function showMessage() {
      isNow = Math.random() < 0.5;
      document.querySelector("#message").textContent = isNow ? "今！" : "今じゃない！";
    }

    function handleTap() {
      if (timer <= 0) return;
      score += isNow ? 1 : -3;
      if (score < 0) score = 0;
      document.querySelector("#score").textContent = score;
    }

    function endGame() {
      document.querySelector("#message").textContent = "終了！";
      const nick = document.getElementById("nickname").value.trim();
      db.collection("scores").add({
        name: nick,
        score: score,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      }).then(loadRanking);
    }

    function loadRanking() {
      db.collection("scores")
        .orderBy("score", "desc")
        .limit(10)
        .get()
        .then(snapshot => {
          const list = document.getElementById("ranking-list");
          list.innerHTML = "";
          snapshot.forEach(doc => {
            const data = doc.data();
            const li = document.createElement("li");
            li.textContent = `${data.name}：${data.score}点`;
            list.appendChild(li);
          });
        });
    }

    window.onload = loadRanking;
  </script>
</body>
</html>
