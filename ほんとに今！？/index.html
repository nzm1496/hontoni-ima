<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒ›ãƒ³ãƒˆã«ä»Šï¼ï¼Ÿ</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      text-align: center;
      margin-top: 60px;
      background-color: #fffce6;
    }
    .hidden {
      display: none;
    }
    #title-screen {
      padding: 40px;
    }
    #game-area {
      margin-top: 40px;
    }
    #message {
      font-size: 48px;
      margin: 30px;
      padding: 20px;
      border-radius: 12px;
      display: inline-block;
    }
    #score, #highscore, #timer {
      font-size: 24px;
      margin: 10px;
    }
    button {
      font-size: 24px;
      padding: 12px 24px;
      margin-top: 20px;
      cursor: pointer;
      border-radius: 12px;
      border: none;
    }
    #start-button {
      background-color: #90ee90;
    }
    #tap-button {
      background-color: #87cefa;
    }
    #restart-button {
      background-color: #ffa07a;
      display: none;
    }
  </style>
</head>
<body>

  <!-- ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ -->
  <div id="title-screen">
    <h1>ğŸ•¹ ãƒ›ãƒ³ãƒˆã«ä»Šï¼ï¼Ÿ</h1>
    <p>ç”»é¢ã«ã€Œä»Šï¼ã€ã¨å‡ºãŸã‚‰å³ã‚¿ãƒƒãƒ—ï¼</p>
    <p>ã§ã‚‚ãƒ•ã‚§ã‚¤ãƒ³ãƒˆã«æ³¨æ„ã€‚éŸ³ã‚„è‰²ã‚„ãƒœã‚¿ãƒ³ã‚‚æƒ‘ã‚ã—ã¦ãã‚‹ã‹ã‚‚ï¼ï¼Ÿ</p>
    <p>30ç§’ã§é«˜ã‚¹ã‚³ã‚¢ã‚’ç›®æŒ‡ãã†ğŸ”¥</p>
    <button id="start-button" onclick="showGame()">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
  </div>

  <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
  <div id="game-area" class="hidden">
    <div id="timer">æ®‹ã‚Š: 30 ç§’</div>
    <div id="score">ã‚¹ã‚³ã‚¢: 0</div>
    <div id="highscore">ãƒã‚¤ã‚¹ã‚³ã‚¢: 0</div>
    <div id="message">æº–å‚™ä¸­â€¦</div><br>
    <button id="tap-button" onclick="handleClick()">ã‚¿ãƒƒãƒ—ï¼</button>
    <button id="restart-button">ã‚‚ã†ä¸€åº¦éŠã¶</button>
  </div>

  <!-- éŸ³å£° -->
  <audio id="sound-now" src="now.wav"></audio>
  <audio id="sound-not" src="not-now.wav"></audio>
  <audio id="bgm" src="bgm.mp3" loop></audio>

  <script>
    let isNow = false;
    let score = 0;
    let highscore = parseInt(localStorage.getItem("highscore")) || 0;
    let intervalTime = 1000;
    let timer = 30;
    let gameInterval, countdownInterval;
    let superNowMode = false;

    const titleScreen = document.getElementById("title-screen");
    const gameArea = document.getElementById("game-area");
    const messageEl = document.getElementById("message");
    const scoreEl = document.getElementById("score");
    const highscoreEl = document.getElementById("highscore");
    const timerEl = document.getElementById("timer");
    const soundNow = document.getElementById("sound-now");
    const soundNot = document.getElementById("sound-not");
    const bgm = document.getElementById("bgm");
    const tapButton = document.getElementById("tap-button");
    const restartButton = document.getElementById("restart-button");

    bgm.volume = 0.05; // éŸ³é‡ã•ã‚‰ã«å°ã•ã

    // ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã‹ã‚‰ã‚²ãƒ¼ãƒ é–‹å§‹
    function showGame() {
      titleScreen.classList.add("hidden");
      gameArea.classList.remove("hidden");
      bgm.pause(); // ã‚²ãƒ¼ãƒ ä¸­ã¯BGMåœæ­¢
      bgm.currentTime = 0;
      startGame();
    }

    function updateMessage() {
      isNow = Math.random() < 0.5;

      if (score >= 15 && !superNowMode) {
        superNowMode = true;
        intervalTime = 600;
        messageEl.style.border = "4px solid gold";
        messageEl.style.boxShadow = "0 0 20px gold";
      }

      const text = isNow ? (superNowMode ? "ğŸ”¥è¶…ä»Šï¼ï¼ğŸ”¥" : "ä»Šï¼") : "ä»Šã˜ã‚ƒãªã„ï¼";
      messageEl.textContent = text;

      const isColorFake = Math.random() < 0.5;
      messageEl.style.backgroundColor = ((isNow && isColorFake) || (!isNow && !isColorFake)) ? "#ff6666" : "#66ff66";

      const isSoundFake = Math.random() < 0.5;
      ((isNow && isSoundFake) || (!isNow && !isSoundFake)) ? soundNot.play() : soundNow.play();

      const isButtonFake = Math.random() < 0.5;
      tapButton.textContent = ((isNow && isButtonFake) || (!isNow && !isButtonFake))
        ? "ãƒ€ãƒ¡ï¼ï¼"
        : (superNowMode ? "è¶…ä»Šã‚¿ãƒƒãƒ—ï¼ï¼ğŸ”¥" : "æŠ¼ã›ï¼ï¼");
      tapButton.style.backgroundColor = tapButton.textContent === "ãƒ€ãƒ¡ï¼ï¼" ? "#ff4444" : "#44ff44";
    }

    function handleClick() {
      if (timer <= 0) return;
      score += isNow ? 1 : -3;
      score = Math.max(0, score);
      scoreEl.textContent = `ã‚¹ã‚³ã‚¢: ${score}`;
    }

    function startGame() {
      score = 0;
      timer = 30;
      superNowMode = false;
      intervalTime = 1000;
      tapButton.disabled = false;
      tapButton.textContent = "ã‚¿ãƒƒãƒ—ï¼";
      messageEl.style = "";
      messageEl.style.backgroundColor = "#fff";
      scoreEl.textContent = `ã‚¹ã‚³ã‚¢: ${score}`;
      timerEl.textContent = `æ®‹ã‚Š: ${timer} ç§’`;
      highscoreEl.textContent = `ãƒã‚¤ã‚¹ã‚³ã‚¢: ${highscore}`;
      restartButton.style.display = "none";

      updateMessage();
      gameInterval = setInterval(updateMessage, intervalTime);
      countdownInterval = setInterval(() => {
        timer--;
        timerEl.textContent = `æ®‹ã‚Š: ${timer} ç§’`;
        if (timer <= 0) {
          clearInterval(gameInterval);
          clearInterval(countdownInterval);
          endGame();
        }
      }, 1000);
    }

    function endGame() {
      messageEl.textContent = "çµ‚äº†ï¼";
      messageEl.style.backgroundColor = "#ccc";
      tapButton.disabled = true;
      restartButton.style.display = "inline-block";
      if (score > highscore) {
        highscore = score;
        localStorage.setItem("highscore", highscore);
        highscoreEl.textContent = `ãƒã‚¤ã‚¹ã‚³ã‚¢: ${highscore}`;
        alert("ãƒã‚¤ã‚¹ã‚³ã‚¢æ›´æ–°ï¼ğŸ‰");
      } else {
        alert("æ™‚é–“åˆ‡ã‚Œï¼ğŸ˜");
      }
    }

    restartButton.addEventListener("click", () => {
      gameArea.classList.add("hidden");
      titleScreen.classList.remove("hidden");
      bgm.currentTime = 0;
      bgm.play(); // ã‚¿ã‚¤ãƒˆãƒ«æˆ»ã£ãŸã‚‰å†ã³BGM
    });

    // æœ€åˆã®ã‚¿ã‚¤ãƒˆãƒ«ã§BGMå†ç”Ÿ
    window.addEventListener("load", () => {
      bgm.play().catch(() => {}); // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã¾ã§ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚‹ãŸã‚try
    });
  </script>
</body>
</html>
